
//alert('only first');
var nav_object = {};
nav_object['/'] = 'Home';
nav_object['/tm1'] = 'Top Level Menu 1';
nav_object['/tm1/tm1i1'] = 'Top Level Menu 1 Item 1';
nav_object['/bar1'] = 'Bar 1';
nav_object['/bar1/bar2'] = 'Bar 2';
nav_object['/bar1/bar2b'] = 'Bar 2b';

var nav = new Nav( nav_object );

document.title = nav.get_title();
var urls_at_level_1 = nav.get_urls_by_level( 1 );
for (var url in urls_at_level_1) {
//  alert('url: ' + url + ' ' + urls_at_level_1[url]);
}

//alert(nav.url_in_url('/', '/bar'));

//alert (nav.get_url_children('/'));

for (var url in nav.get_url_children('/bar1')) {
//  alert (url);
}

var previous_href = window.location.href;
var stateObj = { foo: "bar" };


function change_url(url) {
  if (! url) url = '/';
  var new_href = location.protocol + "//" + location.hostname + url;
  if (location.href == new_href) return;

	if (browser_supports_pushState()) {
		previous_href = window.location.href;
		history.pushState(stateObj, null, url);
		if (previous_href != window.location.href) change();
	} else {
		window.location.href = url;
	}
  return;
}

function browser_supports_pushState() {
	return !(typeof history.pushState === 'undefined');
}

window.onpopstate = detect_href_change;
window.onpushstate = detect_href_change;

function detect_href_change(event) {
	//alert ("href: " + window.location.href + " prev: " + previous_href);
	if (window.location.href != previous_href) {
    previous_href = window.location.href;
	  change();
  }
}

function change() {
	document.title = nav.get_title();
  breadcrumb.update();
}

//alert(get_title());

function get_title(nav_path) {
  var title = 'Default';

  while (nav_path.length) {
    if (typeof nav_object[nav_path] != 'undefined') return nav_object[nav_path];
    var last_index_of_slash = nav_path.lastIndexOf('/');

    if (last_index_of_slash > 0) {
      nav_path = nav_path.substring(0, nav_path.lastIndexOf('/'));
    } else {
      return title;
    }
  }
  return title;
}

alert(nav.get_url_children('/'));

var a = new Anchor( $('#bar'), '/bar/bar', 'change to bar' );
a.add_url_class();

breadcrumb = new Breadcrumb( $( '#breadcrumb' ), nav, 'breadcrumb' );
sidenav = new Sidenav( $( '#sidenav' ), nav, 'sidnav' );

//var blt = $('<div/>');
//var bl = new Breadcrumb_Link(blt, '/', 'Home', 0, 'breadcrumb');
//$('#breadcrumb').append(blt);
//nav_object['/'] = 'Home2';

